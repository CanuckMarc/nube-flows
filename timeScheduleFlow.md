```
[{"id":"36d7512b.b829de","type":"link out","z":"b7177b89.b53138","name":"Schedule","links":["86241514.0f9fa8","83e0286c.75a2d8"],"x":835,"y":880,"wires":[]},{"id":"eed0614a.9b5ca","type":"function","z":"b7177b89.b53138","name":"Current Status","func":"\nmsg.payload = msg.payload;\nmsg.topic = 'Schedule';\n\nnode.status({fill:\"green\",shape:\"dot\",text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":840,"wires":[["36d7512b.b829de"]]},{"id":"9dd67288.8bbce","type":"function","z":"b7177b89.b53138","name":"Schedule enable","func":"moment = context.global.moment;\n\nnow = moment.tz('Australia/Sydney');\nfmt = \"YYYY-MM-DD HH:mm:ss\";\n\nstatus = [\"Current: \"+now.format(fmt)];\n\nholidays = {\n    '2017-12-25': \"Christmas\",\n    '2017-12-26': \"Boxing Day\",\n    '2018-01-01': \"New Years Day\",\n};\n\n\nweekly_sched = {\n    'Monday':    {start: {hour:7,minute:30}, finish: {hour:18,minute:30}},\n    'Tuesday':   {start: {hour:7,minute:30}, finish: {hour:18,minute:30}},\n    'Wednesday': {start: {hour:7,minute:30}, finish: {hour:18,minute:30}},\n    'Thursday':  {start: {hour:7,minute:30}, finish: {hour:18,minute:30}},\n    'Friday':    {start: {hour:7,minute:30}, finish: {hour:18,minute:30}},\n    'Saturday':  {start: {hour:0,minute:0}, finish: {hour:0,minute:0}},\n    'Sunday':    {start: {hour:0,minute:0}, finish: {hour:0,minute:0}},\n};\n\nis_holiday = function(data,dt) {\n    str = dt.format('YYYY-MM-DD');\n    ret = str in data;\n    \n    if(ret) {\n        status.push(\"Holiday: \"+data[str]);\n    }\n    return ret;\n};\n\nin_operating_hours = function(data,dt) {\n    dow = dt.isoWeekday();\n    das = {\n        1: 'Monday',\n        2: 'Tuesday',\n        3: 'Wednesday',\n        4: 'Thursday',\n        5: 'Friday',\n        6: 'Saturday',\n        7: 'Sunday',\n    };\n\n    hours = data[das[dow]];\n\n    sod = moment(dt).hour(hours.start.hour).minute('minute' in hours.start ? hours.start.minute : 0).second(0);\n    eod = moment(dt).hour(hours.finish.hour).minute('minute' in hours.finish ? hours.finish.minute : 0).second(0);\n\n    day_name = das[dow];\n    ret = dt.isBetween(sod,eod);\n    let f = \"hh:mma\";\n    if(!ret) {\n        status.push(\"Out of hours: \"+sod.format(f)+\" - \"+eod.format(f));\n    }\n    return ret;\n};\n\n// Start with enable as true. Then do a logical AND on all conditions\nenable = true;\nenable = !is_holiday(holidays, now) &&\n        in_operating_hours(weekly_sched, now);\n\nnode.status({fill:enable ? \"green\" : \"red\",shape:\"ring\",text: status});\n\nreturn {payload: enable};","outputs":1,"noerr":0,"x":452,"y":713,"wires":[["60dd334.f3352cc","eed0614a.9b5ca"]]},{"id":"3e6d0d98.00fea2","type":"inject","z":"b7177b89.b53138","name":"","topic":"","payload":"","payloadType":"date","repeat":"60","crontab":"","once":false,"x":272,"y":713,"wires":[["9dd67288.8bbce"]]},{"id":"60dd334.f3352cc","type":"debug","z":"b7177b89.b53138","name":"","active":true,"console":"false","complete":"true","x":632,"y":713,"wires":[]}]
```
